<?xml version="1.0" encoding="UTF-8" ?>

<!DOCTYPE sqlMap      
    PUBLIC "-//ibatis.apache.org//DTD SQL Map 2.0//EN"      
    "http://ibatis.apache.org/dtd/sql-map-2.dtd">

<sqlMap>

    <select id="selectUserList" 
            resultClass="jp.terasoluna.fw.collector.db.UserBean"
            resultSetType="SCROLL_INSENSITIVE">
        SELECT
            USER_ID AS "userId",
            USER_FAMILY_NAME AS "familyName",
            USER_FIRST_NAME AS "firstName",
            USER_AGE AS "userAge"
        FROM
            USER_TEST
        WHERE
        	TO_NUMBER(USER_ID) <![CDATA[ < ]]> 10000
        ORDER BY
            TO_NUMBER(USER_ID)
    </select>

    <select id="selectUserListDummy" 
            resultClass="jp.terasoluna.fw.collector.db.UserBean"
            resultSetType="SCROLL_INSENSITIVE">
        SELECT
            USER_ID AS "userId",
            USER_FAMILY_NAME AS "familyName",
            USER_FIRST_NAME AS "firstName",
            USER_AGE AS "userAge"
        FROM
            USER_TEST_DUMMY
        WHERE
        	TO_NUMBER(USER_ID) <![CDATA[ < ]]> 10000
        ORDER BY
            TO_NUMBER(USER_ID)
    </select>
    
    <resultMap id="orderResultMap" class="jp.terasoluna.fw.collector.db.OrderBean" groupBy="ordrId">
		<result property="ordrId" column="ordrId"/>
		<result property="custId" column="custId"/>
		<result property="custName" column="custName"/>
		<result property="orderDate" column="orderDate"/>
		<result property="orderDetailList" resultMap="orderDetailMap"/>
	</resultMap>

	<resultMap id="orderDetailMap" class="jp.terasoluna.fw.collector.db.OrderDetailBean" >
		<result property="detlId" column="detlId"/>
		<result property="prodId" column="prodId"/>
		<result property="prodName" column="prodName"/>
		<result property="quantity" column="quantity"/>
		<result property="amount" column="amount"/>
	</resultMap>

    <select id="selectOrder" resultMap="orderResultMap"  resultClass="jp.terasoluna.fw.collector.db.OrderBean">
        SELECT
            O.ORDR_ID AS "ordrId",
            O.CUST_ID  AS "custId",
            C.CUST_NAME  AS "custName",
            D.DETL_ID  AS "detlId",
            D.PROD_ID  AS "prodId",
            P.PROD_NAME  AS "prodName",
            D.QUANTITY  AS "quantity",
            TO_NUMBER(D.QUANTITY) * TO_NUMBER(P.UNIT_PRICE) AS "amount",
            TO_CHAR(O.ORDR_DATE, 'YYYY/MM/DD HH24:MI:SS') AS "orderDate"
        FROM
            PRODUCT_ORDER O 
            LEFT OUTER JOIN
            	PRODUCT_ORDER_DETAILS D 
            	ON O.ORDR_ID = D.ORDR_ID,
            CUSTOMERS C,
            PRODUCTS P
        WHERE
            O.CUST_ID = C.CUST_ID AND
            D.PROD_ID = P.PROD_ID
    </select>

	<resultMap id="orderResultMap2" class="jp.terasoluna.fw.collector.db.OrderBean">
		<result property="ordrId" column="ordrId"/>
		<result property="custId" column="custId"/>
		<result property="custName" column="custName"/>
		<result property="orderDate" column="orderDate"/>
		<result property="orderDetailList" resultMap="orderDetailMap2"/>
	</resultMap>

	<resultMap id="orderDetailMap2" class="jp.terasoluna.fw.collector.db.OrderDetailBean" >
		<result property="detlId" column="detlId"/>
		<result property="prodId" column="prodId"/>
		<result property="prodName" column="prodName"/>
		<result property="quantity" column="quantity"/>
		<result property="amount" column="amount"/>
	</resultMap>

    <select id="selectOrder2" resultMap="orderResultMap2"  resultClass="jp.terasoluna.fw.collector.db.OrderBean">
        SELECT
            O.ORDR_ID AS "ordrId",
            O.CUST_ID  AS "custId",
            C.CUST_NAME  AS "custName",
            D.DETL_ID  AS "detlId",
            D.PROD_ID  AS "prodId",
            P.PROD_NAME  AS "prodName",
            D.QUANTITY  AS "quantity",
            TO_NUMBER(D.QUANTITY) * TO_NUMBER(P.UNIT_PRICE) AS "amount",
            TO_CHAR(O.ORDR_DATE, 'YYYY/MM/DD HH24:MI:SS') AS "orderDate"
        FROM
            PRODUCT_ORDER O 
            LEFT OUTER JOIN
            	PRODUCT_ORDER_DETAILS D 
            	ON O.ORDR_ID = D.ORDR_ID,
            CUSTOMERS C,
            PRODUCTS P
        WHERE
            O.CUST_ID = C.CUST_ID AND
            D.PROD_ID = P.PROD_ID
    </select>

<!-- 
    <select id="selectOrder3" resultClass="jp.terasoluna.fw.collector.db.OrderBean">
        SELECT
            O.ORDR_ID AS "ordrId",
            O.CUST_ID  AS "custId",
            C.CUST_NAME  AS "custName",
            D.DETL_ID  AS "detlId",
            D.PROD_ID  AS "prodId",
            P.PROD_NAME  AS "prodName",
            D.QUANTITY  AS "quantity",
            TO_NUMBER(D.QUANTITY) * TO_NUMBER(P.UNIT_PRICE) AS "amount",
            TO_CHAR(O.ORDR_DATE, 'YYYY/MM/DD HH24:MI:SS') AS "orderDate"
        FROM
            PRODUCT_ORDER O,
            (SELECT
                DT.ORDR_ID AS "ORDR_ID",
                DT.DETL_ID AS "DETL_ID",
                DT.PROD_ID AS "PROD_ID",
                DT.QUANTITY AS "QUANTITY"
            FROM
                PRODUCT_ORDER_DETAILS DT
            ) D,
            CUSTOMERS C,
            PRODUCTS P
        WHERE
            O.ORDR_ID = D.ORDR_ID AND
            O.CUST_ID = C.CUST_ID AND
            D.PROD_ID = P.PROD_ID
    </select>
 -->

</sqlMap>